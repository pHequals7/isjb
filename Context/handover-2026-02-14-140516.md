# Context Handover — Sector Filtering & Client-Side Search for ISJB

**Session Date:** 2026-02-14 14:05
**Repository:** isjb
**Branch:** main

---

## Session Objective
Add sector/industry filtering and company name search to the Indian Startup Jobs Board. All 242+ companies across 5 VC funds were displayed with no way to filter. The goal was to: (1) acquire sector data for every company, (2) normalize it to ~15 canonical sectors, (3) build a client-side search bar + sector pill toggle UI with no server round-trips.

## What Got Done
- `scripts/fetch-getro.mjs:78-84` — Added `sectors: c.industry_tags || []` to the company map transform. Re-ran for Accel (77 companies) and GC (19 companies).
- `scripts/assign-consider-sectors.mjs` — **Created**. Manual sector assignments for all 233 Consider-sourced companies (PeakXV 112, Lightspeed 65, Nexus 56). Each company mapped to 1-3 sector tags.
- `scripts/normalize-sectors.mjs` — **Created**. Reads `data/sector-map.json`, normalizes raw sector names across all 5 data files, reports unmapped sectors.
- `data/sector-map.json` — **Created**. Maps ~195 raw sector/industry names to 16 canonical categories (SaaS, FinTech, E-Commerce & D2C, etc.).
- `src/lib/types.ts:8` — Added `sectors?: string[]` to `Company` interface.
- `src/components/search-filter-bar.tsx` — **Created**. Search input with magnifying glass icon, X clear button, `/` keyboard shortcut to focus. Sector pills as clickable rounded buttons sorted by frequency with company count badges. "Clear all" link when filters active.
- `src/components/job-board.tsx` — **Created**. Client wrapper component managing `searchQuery`, `debouncedQuery` (150ms), `activeSectors` state. Computes `allSectors` from fund data via `useMemo`. Filters companies per fund: search (case-insensitive includes on name) AND sectors (OR across active sectors). Hides fund sections with 0 matches. Shows empty state with clear button.
- `src/app/page.tsx` — Simplified from 42 lines to 7 lines. Now just loads data and renders `<JobBoard funds={funds} />`.
- `data/accel.json`, `data/gc.json`, `data/peakxv.json`, `data/lightspeed.json`, `data/nexus.json` — All regenerated with normalized `sectors` arrays on every company.
- `npm run build` — Passes cleanly. Static generation works.

## What Didn't Work
- **Consider API `search-companies` endpoint**: Tried using `query: { search: 'Freshworks' }`, `query: { slug: 'freshworks' }`, `query: { slugs: [...] }` — the `search` param is completely ignored. The API always returns the same 60 companies sorted by global job count (CVS Health, PetSmart, etc.). Dead end for programmatic sector lookup.
- **Consider API with India filter + pagination**: Fetched all 1,680 India-filtered companies across 28 pages. Only 1 of our 218 slugs matched (`yubi`). The Consider board uses different slugs than the global API (board slugs are board-specific, e.g. `freshworks` vs the global slug for the same company).
- **Consider company page HTML scraping**: Fetched `https://careers.peakxv.com/jobs/freshworks` — no `__NEXT_DATA__` script tag, no markets/industry data in the HTML source. The page is client-rendered with no useful server-side data.
- **`useRef<ReturnType<typeof setTimeout>>()` without initial value**: TypeScript error in Next.js 16 — `Expected 1 arguments, but got 0`. Fixed by passing `undefined` as initial value.

## Key Decisions
- **Decision**: Manual sector assignments for Consider companies instead of API lookup
  - **Context**: Consider API doesn't expose per-company industry data through any accessible endpoint
  - **Rationale**: These are well-known Indian startups; manual assignment is accurate and avoids unreliable API workarounds. 233 companies is manageable.
  - **Alternatives rejected**: Browser scraping (requires `agent-browser` runtime), Consider API lookup (broken search, slug mismatch), no sectors for Consider companies (would leave 70% of companies untagged)

- **Decision**: 16 canonical sector categories
  - **Context**: Raw data had 192 unique sector names (verbose Getro tags like "Business/Productivity Software" + manual tags like "Quick Commerce")
  - **Rationale**: 16 sectors is enough granularity for filtering without overwhelming the pill UI. Groups related concepts (e.g., all health-related → HealthTech, all finance-related → FinTech).

- **Decision**: Debounce search at 150ms, filter at render time (no workers/virtualization)
  - **Context**: ~242 companies is small enough for synchronous filtering
  - **Rationale**: `useMemo` with deps on `debouncedQuery` and `activeSectors` is sufficient. No need for web workers or virtualized lists at this scale.

## Lessons Learned
- Getro API field for industries is `industry_tags` (not `industries`, `tags`, or `industry`). The `topics` field exists but is always empty.
- Consider's `search-companies` API has a `markets` field (array of strings) on company objects, but the search/filter parameters are effectively broken — the endpoint ignores query filters and returns a fixed global ranking.
- Consider board slugs (used in `/jobs/{slug}` URLs) don't match the global Consider API slugs. There's no reliable way to cross-reference.
- Next.js 16 with React 19 requires explicit `undefined` initial value for `useRef` when the type is nullable.

## Nuances & Edge Cases
- Some companies appear in multiple funds (e.g., `razorpay` in PeakXV and Lightspeed, `hasura` in Lightspeed and Nexus). Sector counts in the pill UI count each occurrence separately (by company entry, not by unique company). This is intentional — filtering shows the company under each relevant fund.
- The `_comment` key in `sector-map.json` is explicitly deleted before processing in `normalize-sectors.mjs`.
- Getro data has `meta.lastUpdated` and `meta.totalCompanies` fields; Consider data files have just `{ companies: [...] }` with no meta block. The `loadVCFunds()` function in `data.ts` handles both.
- Three raw sectors were initially unmapped (`Application Performance Management`, `Automotive`, `Services`) — these were added to the sector map and re-normalized.

## Codebase Map (Files Touched)

### Modified
- `scripts/fetch-getro.mjs` — Added `sectors: c.industry_tags || []` to company transform
- `src/lib/types.ts` — Added `sectors?: string[]` to Company interface
- `src/app/page.tsx` — Simplified to data loading + `<JobBoard>` delegation
- `data/accel.json` — Regenerated with normalized sectors
- `data/gc.json` — Regenerated with normalized sectors
- `data/peakxv.json` — Sectors added and normalized
- `data/lightspeed.json` — Sectors added and normalized
- `data/nexus.json` — Sectors added and normalized

### Created
- `src/components/job-board.tsx` — Client wrapper with search/filter state management
- `src/components/search-filter-bar.tsx` — Search input + sector pill toggles
- `data/sector-map.json` — Raw-to-canonical sector normalization map (195 entries → 16 categories)
- `scripts/assign-consider-sectors.mjs` — Manual sector assignments for 233 Consider companies
- `scripts/normalize-sectors.mjs` — Applies sector map across all data files

### Read / Referenced
- `src/components/company-card.tsx` — Unchanged; renders individual company cards
- `src/components/vc-fund-section.tsx` — Unchanged; renders per-fund section with company grid
- `src/components/vc-nav-bar.tsx` — Unchanged; sticky fund navigation
- `src/components/stats-banner.tsx` — Unchanged; accepts dynamic counts (already prop-driven)
- `src/components/header.tsx` — Unchanged; hero section
- `src/components/footer.tsx` — Unchanged
- `src/lib/data.ts` — Unchanged; `loadVCFunds()` reads JSON files at build time
- `src/config/vc-funds.ts` — VC fund configuration (ids, names, logos, platforms)
- `data/india-filter.json` — Denylist for non-Indian Getro companies
- `data/indian-origin-override.json` — Allowlist for Indian-origin global companies

## Next Steps

1. **Test on mobile viewport (375px)** — Verify sector pills wrap properly and search bar is usable. The pills use `flex-wrap` but should be checked visually. Consider adding horizontal scroll on very narrow screens if wrapping produces too many rows.

2. **Re-scrape Consider boards for fresh job counts** — Run `scripts/scrape-consider-india.mjs` (requires `agent-browser` CLI) followed by `scripts/rebuild-consider-data.mjs`, then `scripts/assign-consider-sectors.mjs` and `scripts/normalize-sectors.mjs` to preserve sectors on refreshed data.

3. **Automate sector assignment for new companies** — When new companies appear in Consider boards after re-scraping, they won't have sector assignments. Either add them to `assign-consider-sectors.mjs` manually, or build a fuzzy-match lookup using company domains against a sector database.

4. **Consider adding URL-based filter state** — Push search query and active sectors to URL params (`?q=razorpay&sectors=FinTech,SaaS`) so filtered views are shareable/bookmarkable. Update `handleSearchChange` and `toggleSector` to sync with `useSearchParams()`.

5. **Sector counts could reflect unique companies** — Currently counts include duplicates across funds. If desired, deduplicate by slug before counting in the `allSectors` useMemo in `job-board.tsx:37-49`.

## Open Questions
- Should sector pills show counts based on all companies or only currently-visible (filtered) companies? Currently shows global counts (total across all funds, unfiltered). Showing filtered counts would update dynamically but might be confusing when multiple sectors are active.
- Should companies with no sector data (edge case — currently none, but possible after re-scraping) be hidden when sector filters are active, or always shown?
